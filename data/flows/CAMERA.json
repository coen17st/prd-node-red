[
  {
    "id": "99fb9363.36373",
    "type": "tab",
    "label": "CAMERA",
    "disabled": false,
    "info": ""
  },
  {
    "id": "566492bf.5ddebc",
    "type": "inject",
    "z": "99fb9363.36373",
    "name": "event end",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "zoneminder/1",
    "payload": "{\"monitor\":\"1\",\"eventid\":\"190\",\"hookvalue\":\"0\",\"eventtype\":\"event_end\",\"state\":\"alarm\",\"name\":\"Ended:Camera_Lise:(190) [a] detected:person:98%  Motion: All\",\"detection\":[]}",
    "payloadType": "json",
    "x": 100,
    "y": 60,
    "wires": [
      [
        "4e17bbbf.dc9024"
      ]
    ]
  },
  {
    "id": "c7e63202.c7e83",
    "type": "mqtt in",
    "z": "99fb9363.36373",
    "name": "",
    "topic": "zoneminder/1",
    "qos": "0",
    "datatype": "json",
    "broker": "fc10aafd.22f7b8",
    "x": 90,
    "y": 120,
    "wires": [
      [
        "4e17bbbf.dc9024"
      ]
    ]
  },
  {
    "id": "4e17bbbf.dc9024",
    "type": "switch",
    "z": "99fb9363.36373",
    "name": "event start / end",
    "property": "payload.eventtype",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "event_end",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "event_start",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 280,
    "y": 120,
    "wires": [
      [
        "48c226f7.cdce18"
      ],
      [
        "d2f02ef5.73151"
      ]
    ]
  },
  {
    "id": "221ddb58.b60e24",
    "type": "ha-entity",
    "z": "99fb9363.36373",
    "name": "",
    "server": "4ba92433.2478cc",
    "version": 1,
    "debugenabled": false,
    "outputs": 1,
    "entityType": "binary_sensor",
    "config": [
      {
        "property": "name",
        "value": "beweging_camera_lise"
      },
      {
        "property": "device_class",
        "value": "motion"
      },
      {
        "property": "icon",
        "value": ""
      },
      {
        "property": "unit_of_measurement",
        "value": ""
      }
    ],
    "state": "payload.eventtype",
    "stateType": "msg",
    "attributes": [
      {
        "property": "image_url",
        "value": "image_url",
        "valueType": "msg"
      },
      {
        "property": "name",
        "value": "payload.name",
        "valueType": "msg"
      },
      {
        "property": "label",
        "value": "payload.detection[0].label",
        "valueType": "msg"
      }
    ],
    "resend": true,
    "outputLocation": "",
    "outputLocationType": "none",
    "inputOverride": "block",
    "x": 1330,
    "y": 60,
    "wires": [
      []
    ]
  },
  {
    "id": "f948112a.8b478",
    "type": "inject",
    "z": "99fb9363.36373",
    "name": "event start",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "zoneminder/1",
    "payload": "{\"monitor\":\"1\",\"state\":\"alarm\",\"name\":\"Camera Lise:(499) [a] detected:person:99%  Motion All\",\"hookvalue\":\"0\",\"eventtype\":\"event_start\",\"detection\":[{\"box\":[570,30,1202,652],\"type\":\"object\",\"confidence\":\"98.82%\",\"label\":\"person\"}],\"eventid\":\"726\"}",
    "payloadType": "json",
    "x": 100,
    "y": 20,
    "wires": [
      [
        "4e17bbbf.dc9024"
      ]
    ]
  },
  {
    "id": "e1db0e75.3b782",
    "type": "switch",
    "z": "99fb9363.36373",
    "name": "",
    "property": "payload.name",
    "propertyType": "msg",
    "rules": [
      {
        "t": "cont",
        "v": "detected",
        "vt": "str"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 590,
    "y": 140,
    "wires": [
      [
        "cec28d04.3291b"
      ],
      [
        "8dad972a.ef5a68",
        "de66adc.5f5ac5"
      ]
    ]
  },
  {
    "id": "9a8161ee.551bf",
    "type": "change",
    "z": "99fb9363.36373",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload.eventtype",
        "pt": "msg",
        "to": "off",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload.detection[0].label",
        "pt": "msg",
        "to": "geen object",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1080,
    "y": 220,
    "wires": [
      [
        "221ddb58.b60e24"
      ]
    ]
  },
  {
    "id": "c8e8638.3867fa",
    "type": "mqtt in",
    "z": "99fb9363.36373",
    "name": "",
    "topic": "zoneminder/5",
    "qos": "0",
    "datatype": "json",
    "broker": "fc10aafd.22f7b8",
    "x": 90,
    "y": 180,
    "wires": [
      [
        "4e17bbbf.dc9024"
      ]
    ]
  },
  {
    "id": "a4ddfe65.ffc77",
    "type": "exec",
    "z": "99fb9363.36373",
    "command": "",
    "addpay": true,
    "append": "",
    "useSpawn": "false",
    "timer": "240",
    "oldrc": false,
    "name": "",
    "x": 1510,
    "y": 120,
    "wires": [
      [
        "ca3897de.ce2db8"
      ],
      [],
      []
    ]
  },
  {
    "id": "d2f02ef5.73151",
    "type": "change",
    "z": "99fb9363.36373",
    "name": "variabelen",
    "rules": [
      {
        "t": "set",
        "p": "weburl",
        "pt": "msg",
        "to": "zoneminder.theautomation.nl",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "fid",
        "pt": "msg",
        "to": "objdetect",
        "tot": "str"
      },
      {
        "t": "change",
        "p": "topic",
        "pt": "msg",
        "from": "zoneminder/",
        "fromt": "str",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 450,
    "y": 140,
    "wires": [
      [
        "e1db0e75.3b782"
      ]
    ]
  },
  {
    "id": "1b3cd2db.0735fd",
    "type": "template",
    "z": "99fb9363.36373",
    "name": "get image command",
    "field": "payload",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "wget \"https://{{weburl}}/zm/index.php?view=image&eid={{payload.eventid}}&fid=objdetect&username={{username}}&password={{password}}\" -O /config/www/image/{{cam_nr}}/{{payload.eventid}}.jpg",
    "output": "str",
    "x": 1340,
    "y": 120,
    "wires": [
      [
        "a4ddfe65.ffc77"
      ]
    ]
  },
  {
    "id": "98be8aa3.4b6648",
    "type": "api-call-service",
    "z": "99fb9363.36373",
    "name": "notify coen",
    "server": "4ba92433.2478cc",
    "version": 3,
    "debugenabled": false,
    "service_domain": "notify",
    "service": "mobile_app_telefoon_coen",
    "entityId": "",
    "data": "{\"title\":\"Beweging gedecteerd\",\"message\":\"{{payload.name}}\",\"data\":{\"image\":\"https://homeassistant.theautomation.nl/local/image/{{cam_nr}}/{{payload.eventid}}.jpg\",\"clickAction\":\"https://homeassistant.theautomation.nl/local/image/{{cam_nr}}/{{payload.eventid}}.jpg\"}}",
    "dataType": "json",
    "mergecontext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1210,
    "y": 360,
    "wires": [
      [
        "94670f64.546f6",
        "bf798686.614068"
      ]
    ]
  },
  {
    "id": "983c8437.e4fec8",
    "type": "change",
    "z": "99fb9363.36373",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "traffic",
        "pt": "msg",
        "to": "stop",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1540,
    "y": 360,
    "wires": [
      [
        "9d2a99d.0e9bd68"
      ]
    ]
  },
  {
    "id": "94670f64.546f6",
    "type": "delay",
    "z": "99fb9363.36373",
    "name": "",
    "pauseType": "delay",
    "timeout": "2",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "x": 1380,
    "y": 360,
    "wires": [
      [
        "983c8437.e4fec8"
      ]
    ]
  },
  {
    "id": "117fa688.7d61a9",
    "type": "exec",
    "z": "99fb9363.36373",
    "command": "",
    "addpay": true,
    "append": "",
    "useSpawn": "false",
    "timer": "240",
    "oldrc": false,
    "name": "",
    "x": 450,
    "y": 300,
    "wires": [
      [],
      [],
      []
    ]
  },
  {
    "id": "1b1b9f3c.ebcd01",
    "type": "template",
    "z": "99fb9363.36373",
    "name": "delete older images",
    "field": "payload",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "find /config/www/image/cam_1 -name \"*.jpg\" -type f -mtime +4 -exec rm -f {} \\; ",
    "output": "str",
    "x": 290,
    "y": 300,
    "wires": [
      [
        "117fa688.7d61a9"
      ]
    ]
  },
  {
    "id": "2852e845.4556a8",
    "type": "change",
    "z": "99fb9363.36373",
    "name": "change payload.name",
    "rules": [
      {
        "t": "change",
        "p": "payload.name",
        "pt": "msg",
        "from": "Camera Lise:(499) [a] detected:",
        "fromt": "str",
        "to": "Camera Lise, gedecteerd: ",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1060,
    "y": 100,
    "wires": [
      [
        "221ddb58.b60e24",
        "1b3cd2db.0735fd",
        "9d2a99d.0e9bd68"
      ]
    ]
  },
  {
    "id": "48c226f7.cdce18",
    "type": "change",
    "z": "99fb9363.36373",
    "name": "end -> off",
    "rules": [
      {
        "t": "change",
        "p": "payload.eventtype",
        "pt": "msg",
        "from": "event_end",
        "fromt": "str",
        "to": "off",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload.detection[0].label",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1100,
    "y": 40,
    "wires": [
      [
        "221ddb58.b60e24"
      ]
    ]
  },
  {
    "id": "2892dc90.dbb214",
    "type": "template",
    "z": "99fb9363.36373",
    "name": "image_url",
    "field": "image_url",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "https://{{weburl}}/zm/index.php?view=image&eid={{payload.eventid}}&fid={{fid}}&username={{username}}&password={{password}}",
    "output": "str",
    "x": 880,
    "y": 100,
    "wires": [
      [
        "2852e845.4556a8"
      ]
    ]
  },
  {
    "id": "de66adc.5f5ac5",
    "type": "change",
    "z": "99fb9363.36373",
    "name": "start -> on",
    "rules": [
      {
        "t": "change",
        "p": "payload.eventtype",
        "pt": "msg",
        "from": "event_start",
        "fromt": "str",
        "to": "on",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload.detection[0].label",
        "pt": "msg",
        "to": "geen object",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1100,
    "y": 160,
    "wires": [
      [
        "221ddb58.b60e24"
      ]
    ]
  },
  {
    "id": "ca3897de.ce2db8",
    "type": "change",
    "z": "99fb9363.36373",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "traffic",
        "pt": "msg",
        "to": "go",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1660,
    "y": 120,
    "wires": [
      [
        "9d2a99d.0e9bd68"
      ]
    ]
  },
  {
    "id": "fd22399.61262c8",
    "type": "inject",
    "z": "99fb9363.36373",
    "name": "start 00:00",
    "props": [
      {
        "p": "delete",
        "v": "",
        "vt": "date"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "00 00 * * *",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "x": 110,
    "y": 300,
    "wires": [
      [
        "1b1b9f3c.ebcd01",
        "fbbf8f14.0db96"
      ]
    ]
  },
  {
    "id": "f3bb87eb.826248",
    "type": "api-current-state",
    "z": "99fb9363.36373",
    "name": "babymonitor is aan",
    "server": "4ba92433.2478cc",
    "version": 2,
    "outputs": 2,
    "halt_if": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "input_boolean.babymonitor",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "input_boolean.babymonitor",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      }
    ],
    "x": 1030,
    "y": 360,
    "wires": [
      [
        "98be8aa3.4b6648"
      ],
      []
    ]
  },
  {
    "id": "bf798686.614068",
    "type": "debug",
    "z": "99fb9363.36373",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1330,
    "y": 480,
    "wires": []
  },
  {
    "id": "cec28d04.3291b",
    "type": "template",
    "z": "99fb9363.36373",
    "name": "cam_nr",
    "field": "cam_nr",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "cam_{{topic}}",
    "output": "str",
    "x": 740,
    "y": 100,
    "wires": [
      [
        "2892dc90.dbb214"
      ]
    ]
  },
  {
    "id": "fbbf8f14.0db96",
    "type": "template",
    "z": "99fb9363.36373",
    "name": "delete older images",
    "field": "payload",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "find /config/www/image/cam_5 -name \"*.jpg\" -type f -mtime +4 -exec rm -f {} \\; ",
    "output": "str",
    "x": 290,
    "y": 340,
    "wires": [
      [
        "117fa688.7d61a9"
      ]
    ]
  },
  {
    "id": "9d2a99d.0e9bd68",
    "type": "traffic",
    "z": "99fb9363.36373",
    "name": "",
    "property_allow": "traffic",
    "filter_allow": "go",
    "ignore_case_allow": false,
    "negate_allow": false,
    "send_allow": false,
    "property_stop": "traffic",
    "filter_stop": "stop",
    "ignore_case_stop": false,
    "negate_stop": false,
    "send_stop": false,
    "default_start": false,
    "differ": true,
    "x": 1310,
    "y": 220,
    "wires": [
      [
        "f3bb87eb.826248"
      ]
    ]
  },
  {
    "id": "8dad972a.ef5a68",
    "type": "stoptimer",
    "z": "99fb9363.36373",
    "duration": "10",
    "units": "Second",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "",
    "x": 890,
    "y": 220,
    "wires": [
      [
        "9a8161ee.551bf"
      ],
      []
    ]
  }
]