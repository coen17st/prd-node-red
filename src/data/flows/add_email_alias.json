[
  {
    "id": "f9efcae4.0a8728",
    "type": "tab",
    "label": "add_email_alias",
    "disabled": false,
    "info": "add_email_alias"
  },
  {
    "id": "914396ec.421b58",
    "type": "comment",
    "z": "f9efcae4.0a8728",
    "name": "add email alias to mailserver docker container ",
    "info": "add email alias to mailserver docker container ",
    "x": 190,
    "y": 40,
    "wires": []
  },
  {
    "id": "8e7cd1ce.12f69",
    "type": "api-current-state",
    "z": "f9efcae4.0a8728",
    "name": "alias hidemyid",
    "server": "4ba92433.2478cc",
    "version": 3,
    "outputs": 2,
    "halt_if": "alias",
    "halt_if_type": "str",
    "halt_if_compare": "is_not",
    "entity_id": "input_text.hidemyid_mail_alias",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "override_topic": false,
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 360,
    "y": 100,
    "wires": [
      [
        "8e1d323a.91ef7"
      ],
      []
    ]
  },
  {
    "id": "63c362fa.94915c",
    "type": "change",
    "z": "f9efcae4.0a8728",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "ssh_command",
        "pt": "msg",
        "to": "ssh coen@192.168.1.3",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 890,
    "y": 120,
    "wires": [
      [
        "59a7c16.9877a4"
      ]
    ]
  },
  {
    "id": "bb34c6ad.5ad1e8",
    "type": "api-current-state",
    "z": "f9efcae4.0a8728",
    "name": "alias theautomation",
    "server": "4ba92433.2478cc",
    "version": 3,
    "outputs": 2,
    "halt_if": "alias",
    "halt_if_type": "str",
    "halt_if_compare": "is_not",
    "entity_id": "input_text.theautomation_mail_alias",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "override_topic": false,
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 370,
    "y": 160,
    "wires": [
      [
        "d4bf95bb.0c8e88"
      ],
      []
    ]
  },
  {
    "id": "14df7999.3c83b6",
    "type": "change",
    "z": "f9efcae4.0a8728",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "domain",
        "pt": "msg",
        "to": "theautomation.nl",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 680,
    "y": 160,
    "wires": [
      [
        "63c362fa.94915c"
      ]
    ]
  },
  {
    "id": "87d20450.ec0718",
    "type": "change",
    "z": "f9efcae4.0a8728",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "domain",
        "pt": "msg",
        "to": "hidemyid.nl",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 680,
    "y": 100,
    "wires": [
      [
        "63c362fa.94915c"
      ]
    ]
  },
  {
    "id": "8e1d323a.91ef7",
    "type": "switch",
    "z": "f9efcae4.0a8728",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "nempty"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 530,
    "y": 100,
    "wires": [
      [
        "87d20450.ec0718"
      ]
    ]
  },
  {
    "id": "d4bf95bb.0c8e88",
    "type": "switch",
    "z": "f9efcae4.0a8728",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "nempty"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 530,
    "y": 160,
    "wires": [
      [
        "14df7999.3c83b6"
      ]
    ]
  },
  {
    "id": "46c3a039.7b921",
    "type": "server-state-changed",
    "z": "f9efcae4.0a8728",
    "name": "script add mail alias is on",
    "server": "4ba92433.2478cc",
    "version": 3,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "script.add_mail_alias",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 130,
    "y": 100,
    "wires": [
      [
        "8e7cd1ce.12f69",
        "bb34c6ad.5ad1e8"
      ],
      []
    ]
  },
  {
    "id": "96f0ae09.82b49",
    "type": "server-state-changed",
    "z": "f9efcae4.0a8728",
    "name": "script add mail alias is on",
    "server": "4ba92433.2478cc",
    "version": 3,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "script.delete_mail_alias",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 130,
    "y": 160,
    "wires": [
      [
        "8e7cd1ce.12f69",
        "bb34c6ad.5ad1e8"
      ],
      []
    ]
  },
  {
    "id": "b0bdc8c1.6c9fc8",
    "type": "exec",
    "z": "f9efcae4.0a8728",
    "command": "",
    "addpay": true,
    "append": "",
    "useSpawn": "false",
    "timer": "",
    "oldrc": false,
    "name": "",
    "x": 590,
    "y": 560,
    "wires": [
      [],
      [],
      [
        "59fdeabc.668d94"
      ]
    ]
  },
  {
    "id": "2d078017.68e42",
    "type": "template",
    "z": "f9efcae4.0a8728",
    "name": "add command",
    "field": "payload",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "{{{ssh_command}}} docker exec prd-mailserver-app setup alias add {{data.state}}@{{{domain}}} coen@{{{domain}}}",
    "output": "str",
    "x": 580,
    "y": 440,
    "wires": [
      [
        "63149408.38e6bc"
      ]
    ]
  },
  {
    "id": "291a2d6a.173ca2",
    "type": "template",
    "z": "f9efcae4.0a8728",
    "name": "del command",
    "field": "payload",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "{{{ssh_command}}} docker exec prd-mailserver-app setup alias del {{data.state}}@{{{domain}}} coen@{{{domain}}}",
    "output": "str",
    "x": 580,
    "y": 480,
    "wires": [
      [
        "d25c87e6.da2818"
      ]
    ]
  },
  {
    "id": "59fdeabc.668d94",
    "type": "switch",
    "z": "f9efcae4.0a8728",
    "name": "exit code 0",
    "property": "payload.code",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "0",
        "vt": "num"
      },
      {
        "t": "neq",
        "v": "0",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 390,
    "y": 640,
    "wires": [
      [
        "b4d34188.b4a93",
        "f0db6c3b.fa87f"
      ],
      [
        "bbb23816.393488"
      ]
    ]
  },
  {
    "id": "b4d34188.b4a93",
    "type": "api-call-service",
    "z": "f9efcae4.0a8728",
    "name": "",
    "server": "4ba92433.2478cc",
    "version": 3,
    "debugenabled": false,
    "service_domain": "input_text",
    "service": "set_value",
    "entityId": "input_text.hidemyid_mail_alias",
    "data": "{\"value\":\"\"}",
    "dataType": "json",
    "mergecontext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 650,
    "y": 640,
    "wires": [
      []
    ]
  },
  {
    "id": "f0db6c3b.fa87f",
    "type": "api-call-service",
    "z": "f9efcae4.0a8728",
    "name": "",
    "server": "4ba92433.2478cc",
    "version": 3,
    "debugenabled": false,
    "service_domain": "input_text",
    "service": "set_value",
    "entityId": "input_text.theautomation_mail_alias",
    "data": "{\"value\":\"\"}",
    "dataType": "json",
    "mergecontext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 650,
    "y": 680,
    "wires": [
      []
    ]
  },
  {
    "id": "f2b7cf6d.8cc9f",
    "type": "template",
    "z": "f9efcae4.0a8728",
    "name": "cat command",
    "field": "payload",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "{{{ssh_command}}} \"cat /home/coen/docker-home-services/mailserver/config/postfix-virtual.cf\"",
    "output": "str",
    "x": 1300,
    "y": 120,
    "wires": [
      [
        "fde2bdff.1e5c8"
      ]
    ]
  },
  {
    "id": "fde2bdff.1e5c8",
    "type": "exec",
    "z": "f9efcae4.0a8728",
    "command": "",
    "addpay": true,
    "append": "",
    "useSpawn": "false",
    "timer": "",
    "oldrc": false,
    "name": "",
    "x": 590,
    "y": 260,
    "wires": [
      [
        "7d12910b.57472"
      ],
      [],
      []
    ]
  },
  {
    "id": "59a7c16.9877a4",
    "type": "template",
    "z": "f9efcae4.0a8728",
    "name": "email address",
    "field": "email_address",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "{{{data.state}}}@{{{domain}}}",
    "output": "str",
    "x": 1120,
    "y": 120,
    "wires": [
      [
        "f2b7cf6d.8cc9f"
      ]
    ]
  },
  {
    "id": "7d12910b.57472",
    "type": "switch",
    "z": "f9efcae4.0a8728",
    "name": "email address exists or not",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "cont",
        "v": "email_address",
        "vt": "msg"
      },
      {
        "t": "else"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 160,
    "y": 420,
    "wires": [
      [
        "9daf1483.f68928"
      ],
      [
        "a177f7b4.5cd5e8"
      ]
    ]
  },
  {
    "id": "a177f7b4.5cd5e8",
    "type": "switch",
    "z": "f9efcae4.0a8728",
    "name": "add or delete",
    "property": "topic",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "script.add_mail_alias",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "script.delete_mail_alias",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 390,
    "y": 440,
    "wires": [
      [
        "2d078017.68e42"
      ],
      [
        "aa34dbf6.0d04c8"
      ]
    ]
  },
  {
    "id": "9daf1483.f68928",
    "type": "switch",
    "z": "f9efcae4.0a8728",
    "name": "add or delete",
    "property": "topic",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "script.add_mail_alias",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "script.delete_mail_alias",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 390,
    "y": 400,
    "wires": [
      [
        "cd407be3.63ccb8"
      ],
      [
        "291a2d6a.173ca2"
      ]
    ]
  },
  {
    "id": "cd407be3.63ccb8",
    "type": "template",
    "z": "f9efcae4.0a8728",
    "name": "message",
    "field": "message",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "Alias \"{{{email_address}}}\" bestaat al en kan niet nogmaals worden toegevoegd.",
    "output": "str",
    "x": 560,
    "y": 340,
    "wires": [
      [
        "22c718ff.c27678"
      ]
    ]
  },
  {
    "id": "aa34dbf6.0d04c8",
    "type": "template",
    "z": "f9efcae4.0a8728",
    "name": "message",
    "field": "message",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "Alias \"{{{email_address}}}\" bestaat niet en kan daarom niet worden verwijderd.",
    "output": "str",
    "x": 560,
    "y": 380,
    "wires": [
      [
        "22c718ff.c27678"
      ]
    ]
  },
  {
    "id": "f7817321.f43fd",
    "type": "api-call-service",
    "z": "f9efcae4.0a8728",
    "name": "notify",
    "server": "4ba92433.2478cc",
    "version": 3,
    "debugenabled": false,
    "service_domain": "notify",
    "service": "mobile_app_phone_coen",
    "entityId": "",
    "data": "{\"message\":\"{{message}}\",\"title\":\"{{topic}}\"}",
    "dataType": "json",
    "mergecontext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1050,
    "y": 520,
    "wires": [
      []
    ]
  },
  {
    "id": "22c718ff.c27678",
    "type": "change",
    "z": "f9efcae4.0a8728",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "E-mail alias",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 710,
    "y": 360,
    "wires": [
      [
        "f7817321.f43fd"
      ]
    ]
  },
  {
    "id": "63149408.38e6bc",
    "type": "template",
    "z": "f9efcae4.0a8728",
    "name": "message_action",
    "field": "message_action",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "toevoegen",
    "output": "str",
    "x": 760,
    "y": 440,
    "wires": [
      [
        "b0bdc8c1.6c9fc8"
      ]
    ]
  },
  {
    "id": "d25c87e6.da2818",
    "type": "template",
    "z": "f9efcae4.0a8728",
    "name": "message_action",
    "field": "message_action",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "verwijderen",
    "output": "str",
    "x": 760,
    "y": 480,
    "wires": [
      [
        "b0bdc8c1.6c9fc8"
      ]
    ]
  },
  {
    "id": "bbb23816.393488",
    "type": "template",
    "z": "f9efcae4.0a8728",
    "name": "message",
    "field": "message_text",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "Error: E-mail alias \"{{{email_address}}}\" {{{message_action}}} is niet gelukt. ",
    "output": "str",
    "x": 600,
    "y": 720,
    "wires": [
      [
        "b8cef7a2.882a18"
      ]
    ]
  },
  {
    "id": "b8cef7a2.882a18",
    "type": "template",
    "z": "f9efcae4.0a8728",
    "name": "topic",
    "field": "topic",
    "fieldType": "msg",
    "format": "handlebars",
    "syntax": "mustache",
    "template": "E-mail alias {{{message_action}}}",
    "output": "str",
    "x": 730,
    "y": 720,
    "wires": [
      [
        "f7817321.f43fd"
      ]
    ]
  }
]